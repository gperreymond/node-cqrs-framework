machine:
  timezone:
    Europe/Paris
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker

dependencies:
  pre:
    - pip install docker-compose

test:
  override:
    - npm run docker:test
  post:
     #docker-compose stop was not stopping containers started with docker-compose run
     # so using this hackity hack to force stop them all
     - docker stop $(docker ps -a -q)
     # get each log separately - docker-compose logs times out, I think it's trying to stream even though the containers are stopped.
     # depends on the standard naming convention of docker-compose
     - docker logs cqrs.test > $CIRCLE_TEST_REPORTS/cqrs.test.log
